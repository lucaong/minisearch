<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | MiniSearch</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Tiny but powerful full-text search"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="MiniSearch"><meta property="twitter:description" content="Tiny but powerful full-text search"></head>
<body class="layout-container manual-root manual-index" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/lucaong/minisearch"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.html"><a href="manual/README.html" data-ice="link"> MiniSearch</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#use-case" data-ice="link">Use case</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#features" data-ice="link">Features</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#installation" data-ice="link">Installation</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#usage" data-ice="link">Usage</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#basic-usage" data-ice="link">Basic usage</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#search-options" data-ice="link">Search options</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#auto-suggestions" data-ice="link">Auto suggestions</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#field-extraction" data-ice="link">Field extraction</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#tokenization" data-ice="link">Tokenization</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#term-processing" data-ice="link">Term processing</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#api-documentation" data-ice="link">API Documentation</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#browser-compatibility" data-ice="link">Browser compatibility</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#contributing" data-ice="link">Contributing</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/CONTRIBUTING.html"><a href="manual/CONTRIBUTING.html" data-ice="link">Contributing</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CONTRIBUTING.html"><a href="manual/CONTRIBUTING.html#bugs-and-feature-requests" data-ice="link">Bugs and feature requests</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CONTRIBUTING.html"><a href="manual/CONTRIBUTING.html#pull-requests" data-ice="link">Pull requests</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html" data-ice="link">Code of Conduct</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html#our-pledge" data-ice="link">Our Pledge</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html#our-standards" data-ice="link">Our Standards</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html#our-responsibilities" data-ice="link">Our Responsibilities</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html#scope" data-ice="link">Scope</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html#enforcement" data-ice="link">Enforcement</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/CODE_OF_CONDUCT.html"><a href="manual/CODE_OF_CONDUCT.html#attribution" data-ice="link">Attribution</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/DESIGN_DOCUMENT.html"><a href="manual/DESIGN_DOCUMENT.html" data-ice="link">Design Document</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/DESIGN_DOCUMENT.html"><a href="manual/DESIGN_DOCUMENT.html#goals--and-non-goals-" data-ice="link">Goals (and non-goals)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/DESIGN_DOCUMENT.html"><a href="manual/DESIGN_DOCUMENT.html#technical-design" data-ice="link">Technical design</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/DESIGN_DOCUMENT.html"><a href="manual/DESIGN_DOCUMENT.html#index-data-structure" data-ice="link">Index data structure</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/DESIGN_DOCUMENT.html"><a href="manual/DESIGN_DOCUMENT.html#fuzzy-search-algorithm" data-ice="link">Fuzzy search algorithm</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/DESIGN_DOCUMENT.html"><a href="manual/DESIGN_DOCUMENT.html#search-api-layer" data-ice="link">Search API layer</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  

  

  <div class="manual-cards">
    
  <div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1> MiniSearch</h1><p><a href="https://travis-ci.org/lucaong/minisearch"><img src="https://travis-ci.org/lucaong/minisearch.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/lucaong/minisearch?branch=master"><img src="https://coveralls.io/repos/github/lucaong/minisearch/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://bundlephobia.com/result?p=minisearch"><img src="https://img.shields.io/bundlephobia/minzip/minisearch.svg?style=flat" alt="Minzipped Size"></a>
<a href="https://www.jsdelivr.com/package/npm/minisearch"><img src="https://data.jsdelivr.com/v1/package/npm/minisearch/badge?style=rounded" alt></a></p><p><code>MiniSearch</code> is a tiny but powerful in-memory fulltext search engine written in
JavaScript. It is respectful of resources, and it can comfortably run both in
Node and in the browser.</p><p>Try out the <a href="https://lucaong.github.io/minisearch/examples/">demo application</a>.</p><p>Find the complete <a href="https://lucaong.github.io/minisearch">documentation and API reference
here</a>, and more background about
<code>MiniSearch</code>, including a comparison with other similar libraries, in <a href="https://lucaongaro.eu/blog/2019/01/30/minisearch-client-side-fulltext-search-engine.html">this blog
post</a>.</p><h2>Use case</h2><p><code>MiniSearch</code> addresses use cases where full-text search features are needed
(e.g. prefix search, fuzzy search, ranking, boosting of fields&#x2026;), but the data
to be indexed can fit locally in the process memory. While you won&apos;t index the
whole Internet with it, there are surprisingly many use cases that are served
well by <code>MiniSearch</code>. By storing the index in local memory, <code>MiniSearch</code> can
work offline, and can process queries quickly, without network latency.</p><p>A prominent use-case is real time search &quot;as you type&quot; in web and mobile
applications, where keeping the index on the client enables fast and reactive
UIs, removing the need to make requests to a search server.</p><h2>Features</h2><ul>
<li><p>Memory-efficient index, designed to support memory-constrained use cases
like mobile browsers.</p>
</li>
<li><p>Exact match, prefix search, fuzzy match, field boosting</p>
</li>
<li><p>Auto-suggestion engine, for auto-completion of search queries</p>
</li>
<li><p>Documents can be added and removed from the index at any time</p>
</li>
<li><p>Zero external dependencies</p>
</li>
</ul><p><code>MiniSearch</code> strives to expose a simple API that provides the building blocks to
build custom solutions, while keeping a small and well tested codebase.</p><h2>Installation</h2><p>With <code>npm</code>:</p><pre><code><code class="source-code prettyprint">npm install --save minisearch</code>
</code></pre><p>With <code>yarn</code>:</p><pre><code><code class="source-code prettyprint">yarn add minisearch</code>
</code></pre><p>Then <code>require</code> or <code>import</code> it in your project.</p><p>Alternatively, if you prefer to use a <code>&lt;script&gt;</code> tag, you can require MiniSearch
from a CDN:</p><pre><code><code class="source-code prettyprint">&lt;script src=&quot;https://cdn.jsdelivr.net/npm/minisearch@2.0.6/dist/minisearch.min.js&quot;&gt;&lt;/script&gt;</code>
</code></pre><p>Finally, if you want to manually build the library, clone the repository and run
<code>yarn build</code> (or <code>yarn build-minified</code> for a minified version + source maps).
The compiled source will be created in the <code>dist</code> folder.</p><h2>Usage</h2><h3>Basic usage</h3><pre><code class="lang-javascript"><code class="source-code prettyprint">// A collection of documents for our examples
const documents = [
  {
    id: 1,
    title: &apos;Moby Dick&apos;,
    text: &apos;Call me Ishmael. Some years ago...&apos;,
    category: &apos;fiction&apos;
  },
  {
    id: 2,
    title: &apos;Zen and the Art of Motorcycle Maintenance&apos;,
    text: &apos;I can see by my watch...&apos;,
    category: &apos;fiction&apos;
  },
  {
    id: 3,
    title: &apos;Neuromancer&apos;,
    text: &apos;The sky above the port was...&apos;,
    category: &apos;fiction&apos;
  },
  {
    id: 4,
    title: &apos;Zen and the Art of Archery&apos;,
    text: &apos;At first sight it must seem...&apos;,
    category: &apos;non-fiction&apos;
  },
  // ...and more
]

let miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;text&apos;], // fields to index for full-text search
  storeFields: [&apos;title&apos;, &apos;category&apos;] // fields to return with search results
})

// Index all documents
miniSearch.addAll(documents)

// Search with default options
let results = miniSearch.search(&apos;zen art motorcycle&apos;)
// =&gt; [
//   { id: 2, title: &apos;Zen and the Art of Motorcycle Maintenance&apos;, category: &apos;fiction&apos;, score: 2.77258, match: { ... } },
//   { id: 4, title: &apos;Zen and the Art of Archery&apos;, category: &apos;non-fiction&apos;, score: 1.38629, match: { ... } }
// ]</code>
</code></pre><h3>Search options</h3><p><code>MiniSearch</code> supports several options for more advanced search behavior:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">// Search only specific fields
miniSearch.search(&apos;zen&apos;, { fields: [&apos;title&apos;] })

// Boost some fields (here &quot;title&quot;)
miniSearch.search(&apos;zen&apos;, { boost: { title: 2 } })

// Prefix search (so that &apos;moto&apos; will match &apos;motorcycle&apos;)
miniSearch.search(&apos;moto&apos;, { prefix: true })

// Search within a specific category
miniSearch.search(&apos;zen&apos;, {
  filter: (result) =&gt; result.category === &apos;fiction&apos;
})

// Fuzzy search, in this example, with a max edit distance of 0.2 * term length,
// rounded to nearest integer. The mispelled &apos;ismael&apos; will match &apos;ishmael&apos;.
miniSearch.search(&apos;ismael&apos;, { fuzzy: 0.2 })

// You can set the default search options upon initialization
miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;text&apos;],
  searchOptions: {
    boost: { title: 2 },
    fuzzy: 0.2
  }
})
miniSearch.addAll(documents)

// It will now by default perform fuzzy search and boost &quot;title&quot;:
miniSearch.search(&apos;zen and motorcycles&apos;)</code>
</code></pre><h3>Auto suggestions</h3><p><code>MiniSearch</code> can suggest search queries given an incomplete query:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">miniSearch.autoSuggest(&apos;zen ar&apos;)
// =&gt; [ { suggestion: &apos;zen archery art&apos;, terms: [ &apos;zen&apos;, &apos;archery&apos;, &apos;art&apos; ], score: 1.73332 },
//      { suggestion: &apos;zen art&apos;, terms: [ &apos;zen&apos;, &apos;art&apos; ], score: 1.21313 } ]</code>
</code></pre><p>The <code>autoSuggest</code> method takes the same options as the <code>search</code> method, so you
can get suggestions for misspelled words using fuzzy search:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">miniSearch.autoSuggest(&apos;neromancer&apos;, { fuzzy: 0.2 })
// =&gt; [ { suggestion: &apos;neuromancer&apos;, terms: [ &apos;neuromancer&apos; ], score: 1.03998 } ]</code>
</code></pre><p>Suggestions are ranked by the relevance of the documents that would be returned
by that search.</p><p>Sometimes, you might need to filter auto suggestions to, say, only a specific
category. You can do so by providing a <code>filter</code> option:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">miniSearch.autoSuggest(&apos;zen ar&apos;, {
  filter: (result) =&gt; result.category === &apos;fiction&apos;
})
// =&gt; [ { suggestion: &apos;zen art&apos;, terms: [ &apos;zen&apos;, &apos;art&apos; ], score: 1.21313 } ]</code>
</code></pre><h3>Field extraction</h3><p>By default, documents are assumed to be plain key-value objects with field names
as keys and field values as string values. In order to support custom field
extraction logic (for example for nested fields, or non-string field values
needing processing before tokenization), a custom field extractor function can
be passed as the <code>extractField</code> option:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">// Assuming that our documents look like:
const documents = [
  { id: 1, title: &apos;Moby Dick&apos;, author: { name: &apos;Herman Melville&apos; }, tags: [&apos;fiction&apos;, &apos;whale&apos;] },
  { id: 2, title: &apos;Zen and the Art of Motorcycle Maintenance&apos;, author: { name: &apos;Robert Pirsig&apos; }, tags: [&apos;fiction&apos;, &apos;zen&apos;] },
  { id: 3, title: &apos;Neuromancer&apos;, author: { name: &apos;William Gibson&apos; }, tags: [&apos;fiction&apos;, &apos;cyberpunk&apos;] },
  { id: 4, title: &apos;Zen and the Art of Archery&apos;, author: { name: &apos;Eugen Herrigel&apos; }, tags: [&apos;non-fiction&apos;, &apos;zen&apos;] },
  // ...and more
]

// We can support nested fields (author.name) and array fields (tags) with a
// custom `extractField` function:
let miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;author.name&apos;, &apos;tags&apos;],
  extractField: (document, fieldName) =&gt; {
    // Access nested fields
    const value = fieldName.split(&apos;.&apos;).reduce((doc, key) =&gt; doc &amp;&amp; doc[key], document)
    // If field value is an array, join by space
    return Array.isArray(value) ? value.join(&apos; &apos;) : value
  }
})</code>
</code></pre><p>The default field extractor can be obtained by calling
<code>MiniSearch.getDefault(&apos;extractField&apos;)</code>.</p><h3>Tokenization</h3><p>By default, documents are tokenized by splitting on Unicode space or punctuation
characters. The tokenization logic can be easily changed by passing a custom
tokenizer function as the <code>tokenize</code> option:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">// Tokenize splitting by hyphen
let miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;text&apos;],
  tokenize: (string, _fieldName) =&gt; string.split(&apos;-&apos;)
})</code>
</code></pre><p>Upon search, the same tokenization is used by default, but it is possible to
pass a <code>tokenize</code> search option in case a different search-time tokenization is
necessary:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">// Tokenize splitting by hyphen
let miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;text&apos;],
  tokenize: (string) =&gt; string.split(&apos;-&apos;), // indexing tokenizer
  searchOptions: {
    tokenize: (string) =&gt; string.split(/[\s-]+/) // search query tokenizer
  }
})</code>
</code></pre><p>The default tokenizer can be obtained by calling
<code>MiniSearch.getDefault(&apos;tokenize&apos;)</code>.</p><h3>Term processing</h3><p>Terms are downcased by default. No stemming is performed, and no stop-word list
is applied. To customize how the terms are processed upon indexing, for example
to normalize them, filter them, or to apply stemming, the <code>processTerm</code> option
can be used. The <code>processTerm</code> function should return the processed term as a
string, or a falsy value if the term should be discarded:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">let stopWords = new Set([&apos;and&apos;, &apos;or&apos;, &apos;to&apos;, &apos;in&apos;, &apos;a&apos;, &apos;the&apos;, /* ...and more */ ])

// Perform custom term processing (here discarding stop words and downcasing)
let miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;text&apos;],
  processTerm: (term, _fieldName) =&gt;
    stopWords.has(term) ? null : term.toLowerCase()
})</code>
</code></pre><p>By default, the same processing is applied to search queries. In order to apply
a different processing to search queries, supply a <code>processTerm</code> search option:</p><pre><code class="lang-javascript"><code class="source-code prettyprint">let miniSearch = new MiniSearch({
  fields: [&apos;title&apos;, &apos;text&apos;],
  processTerm: (term) =&gt;
    stopWords.has(term) ? null : term.toLowerCase(), // index term processing
  searchOptions: {
    processTerm: (term) =&gt; term.toLowerCase() // search query processing
  }
})</code>
</code></pre><p>The default term processor can be obtained by calling
<code>MiniSearch.getDefault(&apos;processTerm&apos;)</code>.</p><h3>API Documentation</h3><p>Refer to the <a href="https://lucaong.github.io/minisearch/identifiers.html">API documentation</a>
for details about configuration options and methods.</p><h2>Browser compatibility</h2><p><code>MiniSearch</code> natively supports all modern browsers implementing JavaScript
standards, but requires a polyfill when used in Internet Explorer, as it makes
use functions like <code>Object.entries</code>, <code>Array.includes</code>, and <code>Array.from</code>, which
are standard but not available on older browsers. The package
<a href="https://github.com/zloirock/core-js"><code>core-js</code></a> is one such polyfill that can
be used to provide those functions.</p><h2>Contributing</h2><p>Contributions to <code>MiniSearch</code> are welcome! Please read the <a href="https://lucaong.github.io/minisearch/manual/CONTRIBUTING.html">contributions
guidelines</a>.
Reading the <a href="https://lucaong.github.io/minisearch/manual/DESIGN_DOCUMENT.html">design
document</a> is
also useful to understand the project goals and the technical implementation.</p></div>
        <a data-ice="link" href="manual/README.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Contributing</h1><p>Contributions to <code>MiniSearch</code> are welcome :) Just follow the guidelines below.</p><h2>Bugs and feature requests</h2><p>If you have an idea for a feature, or spotted a bug, please <a href="https://github.com/lucaong/minisearch/issues">open an
issue on GitHub</a>.</p><ul>
<li><p>Check if your issue was already reported. In that case, better
to comment on the existing issue rather than open a duplicate one.</p>
</li>
<li><p>When reporting a bug, whenever possible, provide some example code to
reproduce the bug: that will make the process of fixing it much faster.</p>
</li>
<li><p>Remember this is an open-source project. Your feature requests will be
discussed and taken into consideration, but please do not take it
personally if the feature does not get implemented. This project uses a
permissive license, so pull requests are welcome and forks are permitted.</p>
</li>
<li><p>Always be respectful of others when discussing issues. The project
maintainer has the right and responsibility to remove or close discussions
where the tone or language is derogatory, harassing, or offensive toward
others. Keep the <a href="https://lucaong.github.io/minisearch/manual/CODE_OF_CONDUCT.html">Code of
Conduct</a>
in mind.</p>
</li>
</ul><h2>Pull requests</h2><p>Thinking about sending a pull request? That is great :) Here is how you can
setup your development environment:</p><ol>
<li><p>Clone the <a href="https://github.com/lucaong/minisearch">repository</a></p>
</li>
<li><p>Install the development dependencies with <code>yarn install</code></p>
</li>
<li><p>Run the tests with <code>yarn test</code>. You can also automatically trigger a run of
relevant tests for the code that you change by running <code>yarn test-watch</code></p>
</li>
<li><p>If you are working on optimising the performance, you can run the
performance benchmarks with <code>yarn benchmark</code></p>
</li>
<li><p>If you are improving the documentation, you can build the docs with <code>yarn
build-docs</code></p>
</li>
</ol><p>In order to understand implementation details and design goals, read the <a href="https://lucaong.github.io/minisearch/manual/DESIGN_DOCUMENT.html">design
document</a>.</p><p>Also, please follow these guidelines:</p><ul>
<li><p>Add tests for your code. This ensures that your feature won&apos;t be broken by
further code changes. If you are not sure how to test, feel free to send the
pull request and ask for advices in the comment.</p>
</li>
<li><p>Don&apos;t change the version number. That will be done by the mainteiner upon
releasing a new version.</p>
</li>
<li><p>Make sure that the full test suite passes before sending the pull request.</p>
</li>
</ul></div>
        <a data-ice="link" href="manual/CONTRIBUTING.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Code of Conduct</h1><h2>Our Pledge</h2><p>In the interest of fostering an open and welcoming environment, we as
contributors and maintainers pledge to making participation in our project and
our community a harassment-free experience for everyone, regardless of age, body
size, disability, ethnicity, sex characteristics, gender identity and expression,
level of experience, education, socio-economic status, nationality, personal
appearance, race, religion, or sexual identity and orientation.</p><h2>Our Standards</h2><p>Examples of behavior that contributes to creating a positive environment
include:</p><ul>
<li>Using welcoming and inclusive language</li>
<li>Being respectful of differing viewpoints and experiences</li>
<li>Gracefully accepting constructive criticism</li>
<li>Focusing on what is best for the community</li>
<li>Showing empathy towards other community members</li>
</ul><p>Examples of unacceptable behavior by participants include:</p><ul>
<li>The use of sexualized language or imagery and unwelcome sexual attention or
advances</li>
<li>Trolling, insulting/derogatory comments, and personal or political attacks</li>
<li>Public or private harassment</li>
<li>Publishing others&apos; private information, such as a physical or electronic
address, without explicit permission</li>
<li>Other conduct which could reasonably be considered inappropriate in a
professional setting</li>
</ul><h2>Our Responsibilities</h2><p>Project maintainers are responsible for clarifying the standards of acceptable
behavior and are expected to take appropriate and fair corrective action in
response to any instances of unacceptable behavior.</p><p>Project maintainers have the right and responsibility to remove, edit, or
reject comments, commits, code, wiki edits, issues, and other contributions
that are not aligned to this Code of Conduct, or to ban temporarily or
permanently any contributor for other behaviors that they deem inappropriate,
threatening, offensive, or harmful.</p><h2>Scope</h2><p>This Code of Conduct applies both within project spaces and in public spaces
when an individual is representing the project or its community. Examples of
representing a project or community include using an official project e-mail
address, posting via an official social media account, or acting as an appointed
representative at an online or offline event. Representation of a project may be
further defined and clarified by project maintainers.</p><h2>Enforcement</h2><p>Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported by contacting the project maintainer at <code>mail[AT]lucaongaro.eu</code>. All
complaints will be reviewed and investigated and will result in a response that
is deemed necessary and appropriate to the circumstances. The project team is
obligated to maintain confidentiality with regard to the reporter of an incident.
Further details of specific enforcement policies may be posted separately.</p><p>Project maintainers who do not follow or enforce the Code of Conduct in good
faith may face temporary or permanent repercussions as determined by other
members of the project&apos;s leadership.</p><h2>Attribution</h2><p>This Code of Conduct is adapted from the <a href="https://www.contributor-covenant.org">Contributor Covenant</a>, version 1.4,
available at <a href="https://www.contributor-covenant.org/version/1/4/code-of-conduct.html">https://www.contributor-covenant.org/version/1/4/code-of-conduct.html</a></p><p>For answers to common questions about this code of conduct, see
<a href="https://www.contributor-covenant.org/faq">https://www.contributor-covenant.org/faq</a></p></div>
        <a data-ice="link" href="manual/CODE_OF_CONDUCT.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Design Document</h1><p>This design document has the aim to explain the details of <code>MiniSearch</code>
design and implementation to library developers that intend to contribute to
this project, or that are simply curious about the internals.</p><p><strong>Latest update: Feb. 11, 2019</strong></p><h2>Goals (and non-goals)</h2><p><code>MiniSearch</code> is aimed at providing rich full-text search functionalities in a
local setup (e.g. client side, in the browser). It is therefore optimized for:</p><ol>
<li>Small memory footprint of the index data structure</li>
<li>Fast indexing of documents</li>
<li>Versatile and performant search features, to the extent possible while
meeting goals 1 and 2</li>
<li>Small and simple API surface, on top of which more specific solutions can
be built by application developers</li>
<li>Possibility to add and remove documents from the index at any time</li>
</ol><p><code>MiniSearch</code> is therefore NOT directly aimed at offering:</p><ul>
<li>A solution for use cases requiring large index data structure size</li>
<li>Distributed setup where the index resides on multiple nodes and need to be
kept in sync</li>
<li>Turn-key opinionated solutions (e.g. supporting multiple locales):
<code>MiniSearch</code> <em>enables</em> developer to build these on top of the core API, but
does not provide it out of the box.</li>
</ul><p>For these points listed as non-goals, other solutions exist that should be
preferred to <code>MiniSearch</code>. Adapting <code>MiniSearch</code> to support those goals would in
fact necessarily go against the primary project goals.</p><h2>Technical design</h2><p><code>MiniSearch</code> is composed of two layers:</p><ol>
<li>A compact and versatile data structure for indexing terms, providing
prefix and fuzzy lookup</li>
<li>An API layer on top of this data structure, providing the search
features</li>
</ol><p>Here follows a description of these two layers.</p><h3>Index data structure</h3><p>The data structure chosen for the index is a <a href="https://en.wikipedia.org/wiki/Radix_tree">radix
tree</a>, which is a prefix tree where
nodes with no siblings are merged with the parent node. The reason for choosing
this data structure follows from the project goals:</p><ul>
<li>The radix tree minimizes the memory footprint of the index, because common
prefixes are stored only once, and nodes are compressed into a single
multi-character node whenever possible.</li>
<li>Radix trees offer fast key lookup, with performance proportional to the key
length, and fast lookup of subtrees sharing the same key prefix. These
properties make it possible to offer exact match and prefix search.</li>
<li>On top of a radix tree it is possible to implement lookup of keys that are
within a certain maximum edit distance from a given key. This search rapidly
becomes complex as the maximum distance grows, but for practical search
use-cases the maximum distance is small enough for this algorithm to be
performant. Other more performant solutions for fuzzy search would require
more space (e.g. n-gram indexes).</li>
</ul><p>The class implementing the radix tree is called <code>SearchableMap</code>, because it
implements the standard JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><code>Map</code>
interface</a>,
adding on top of it some key lookup methods:</p><ul>
<li><code>SearchableMap.prototype.atPrefix(prefix)</code>, returning another
<code>SearchableMap</code> representing a mutable view of the original one, containing
only entries where the keys share the given prefix.</li>
<li><code>SearchableMap.prototype.fuzzyGet(searchKey, maxEditDistance)</code>, returning
all the entries where the key is within the given edit (Levenshtein)
distance from <code>searchKey</code>.</li>
</ul><p>As a trade-off for offering these additional features, <code>SearchableMap</code> is
restricted to use only string keys.</p><p>The <code>SearchableMap</code> data type is part of the public API of <code>MiniSearch</code>, exposed
as <code>MiniSearch.SearchableMap</code>. Its usefulness is in fact not limited to
providing a data structure for the inverted index, and developers can use it as
a building block for other solutions. When modifying this class, one should
think about it in terms of a generic data structure, that could in principle be
released as a separate library.</p><h3>Fuzzy search algorithm</h3><p>The algorithm used to provide fuzzy search of keys within a maximum <a href="https://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein
distance</a> from a given term
is the following:</p><ul>
<li>The search starts with a budget of edit distance, initially equal to the
given maximum distance.</li>
<li>The radix tree is traversed, starting from the root, visiting each path and
propagating the remaining budget along each path, but quitting any search
path along which the budget is exhausted.</li>
<li>For each visited node in the radix tree, the string contained in the node is
traversed character by character using cursors that are kept on a stack.</li>
<li>Each cursor has: a pointer to a position in the node string; a pointer to a
corresponding position in the search string; the type of the last edit,
either <code>deletion</code>, or <code>insertion</code>, or <code>change</code>, or <code>none</code>; a budget of
&quot;available edits&quot;. This budget is decremented whenever an edit is required.
The budget is passed from parent to children cursors.</li>
<li>The algorithm pulls cursors from the stack, and compares the pointed
character in the node string with the pointed character in the search
string:<ul>
<li>if they are the same, one single child cursor is created, advancing both
pointers of 1 position. No edit was necessary, so the last edit type is
<code>none</code>.</li>
<li>if they are not the same, and the remaining budget is higher than zero, up
to three children cursors are created: one corresponding to a character
<code>change</code>, where both pointers are incremented by 1; one corresponding to a
<code>deletion</code>, where only the search string pointer is incremented; one
corresponding to an <code>insertion</code>, where only the node string pointer is
incremented. Each of the children cursors have a budget that is one less
the parent budget.</li>
<li>Some special cases are considered to avoid creating unnecessary cursors. A
sequence of adjacent <code>deletion</code>-<code>insertion</code>, or <code>insertion</code>-<code>deletion</code>,
would have the same effect of a change, but would consume more budget:
therefore, a delete cursor is never created after a insertion cursor, and
vice-versa. Similarily, adjacent <code>change</code>-<code>deletion</code> and
<code>deletion</code>-<code>change</code>, or <code>change</code>-<code>insertion</code> and <code>insertion</code>-<code>change</code>, are
equivalent. Therefore, only one of these cases is generated, by never
producing a change cursor after a deletion or insertion one.</li>
</ul>
</li>
<li>Whenever the algorithm finds a leaf node, it reports it as a result.</li>
</ul><p>Note that this algorithm can get complex if the maximum edit distance is large,
as many paths would be followed. The reason why this algorithm is employed is a
trade-off:</p><ul>
<li>For full-text search purposes, the maximum edit distance is small, so the
algorithm is performant enough</li>
<li>The alternatives (e.g. trigram indexes), would require much more space</li>
<li>As <code>MiniSearch</code> is optimized for local and possibly memory-constrained
setup, higher computation complexity is traded in exchange for smaller space
requirement for the index.</li>
</ul><h3>Search API layer</h3><p>The search API layer offers a small and simple API surface for application
developers. It does not assume that a specific locale is used in the indexed
documents, therefore no stemming nor stop-word filtering is performed, but
instead offers easy options for developers to provide their own implementation.
This heuristic will be followed in future development too: rather than providing
an opinionated solution, the project will offer simple building blocks for
application developers to implement their own solutions.</p><p>The inverted index is implemented with <code>SearchableMap</code>, and posting lists are
stored as values in the Map. This way, the same data structure provides both the
inverted index and the set of indexed terms. Different document fields are
indexed within the same index, to further save space. The index is therefore
structured as following:</p><pre><code><code class="source-code prettyprint">term -&gt; field -&gt; { document frequency, posting list }</code>
</code></pre><p>When performing a search, the entries corresponding to the search term are
looked up in the index (optionally searching the index with prefix or fuzzy
search), then the documents are scored with a variant of
<a href="https://en.wikipedia.org/wiki/Tf&#x2013;idf">Tf-Idf</a>, and finally results for
different search terms are merged with the given combinator function (by default
<code>OR</code>, but <code>AND</code> can be specified).</p><p>As the document IDs necessarily occur many times in the posting list, as a space
optimization they are substituted by short generated IDs. An index of short ID
to original ID is maintained alongside the search index, to reconstruct the
original IDs. A similar optimization is applied to the field names.</p></div>
        <a data-ice="link" href="manual/DESIGN_DOCUMENT.html"></a>
      </div>
    </div>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
